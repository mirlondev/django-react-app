<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rapport d'Intervention</title>
  <style>
    @page { 
      size: A4; 
      margin: 15mm 15mm 15mm 15mm;
      
      @top-center {
        content: "Rapport d'Intervention";
        font-size: 12px;
        color: #666;
      }
      
      @bottom-center {
        content: "Page " counter(page) " sur " counter(pages);
        font-size: 10px;
        color: #666;
      }
    }

    body {
      font-family: "Helvetica", Arial, sans-serif;
      color: #333;
      font-size: 12px;
      line-height: 1.4;
      margin: 0;
      padding: 0;
    }

    .container {
      width: 100%;
      box-sizing: border-box;
    }

    /* En-tête */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      border-bottom: 2px solid #2c3e50;
      padding-bottom: 10px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-container img { 
      height: 50px; 
      width: auto; 
      object-fit: contain; 
    }
    
    .company-info {
      font-size: 11px;
      color: #555;
    }
    
    .title {
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      flex: 1;
    }
    
    .report-info {
      text-align: right;
      font-size: 11px;
    }

    /* Blocs d'information */
    .info-row { 
      display: flex; 
      gap: 15px; 
      margin-bottom: 15px;
    }
    
    .info-box { 
      background: #f8f9fa; 
      padding: 12px;
      border-radius: 4px; 
      flex: 1;
      border-left: 4px solid #3498db;
    }
    
    .info-box h3 { 
      margin: 0 0 8px 0; 
      font-size: 13px; 
      color: #2c3e50;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }
    
    .info-item {
      display: flex;
      margin-bottom: 5px;
    }
    
    .info-label {
      font-weight: 600;
      min-width: 100px;
      color: #555;
    }
    
    .info-value {
      flex: 1;
      color: #222;
    }

    /* Tableau des détails */
    .details-table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-bottom: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .details-table th { 
      background: #2c3e50; 
      color: #fff; 
      padding: 8px 10px; 
      font-size: 11px; 
      text-align: left;
      font-weight: 600;
    }
    
    .details-table td { 
      padding: 8px 10px; 
      border: 1px solid #e9ecef; 
      vertical-align: top;
    }
    
    .details-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .cost-highlight {
      font-weight: 600;
      color: #e74c3c;
    }

    /* Style des sections */
    .section { 
      margin-bottom: 15px;
    }
    
    .section-title { 
      font-size: 14px; 
      color: #2c3e50; 
      font-weight: 600;
      border-bottom: 2px solid #3498db;
      padding-bottom: 5px;
      margin-bottom: 8px;
    }
    
    .section-content {
      padding: 10px;
      background: #f8f9fa;
      border-radius: 4px;
    }
    
    /* Tableau du matériel */
    .materials-table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 8px;
    }
    
    .materials-table th, 
    .materials-table td { 
      padding: 6px 8px; 
      border: 1px solid #e9ecef; 
    }
    
    .materials-table th { 
      background: #2c3e50; 
      color: #fff; 
      font-size: 11px; 
      font-weight: 600;
    }
    
    .materials-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    .materials-table td:last-child {
      text-align: right;
    }

    /* Signatures */
    .signature-row { 
      display: flex; 
      justify-content: space-between; 
      gap: 20px; 
      margin-top: 30px;
      page-break-inside: avoid;
    }
    
    .signature-box { 
      flex: 1; 
      text-align: center;
    }
    
    .signature-line { 
      margin-top: 40px; 
      border-top: 1px solid #000; 
      padding-top: 5px;
    }
    
    .signature-name {
      font-weight: 600;
      margin-top: 5px;
    }
    
    .signature-date {
      font-size: 11px;
      color: #666;
    }

    /* Pied de page */
    .footer { 
      margin-top: 20px; 
      font-size: 10px; 
      color: #666; 
      text-align: center;
      border-top: 1px solid #e9ecef;
      padding-top: 10px;
    }
    
    /* Badges de statut */
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      margin-left: 5px;
    }
    
    .status-completed {
      background: #2ecc71;
      color: white;
    }
    
    .status-pending {
      background: #f39c12;
      color: white;
    }
    
    .status-cancelled {
      background: #e74c3c;
      color: white;
    }

    /* Utilitaires */
    .text-right {
      text-align: right;
    }
    
    .no-break { 
      page-break-inside: avoid; 
    }
    
    .mt-10 {
      margin-top: 10px;
    }
    
    .mb-10 {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- En-tête -->
    <div class="header no-break">
      <div class="logo-container">
        {% if logo_url %}
          <img src="{{ logo_url }}" alt="Logo de l'entreprise" />
        {% endif %}
        <div class="company-info">
          <strong>Nom de Votre Entreprise</strong><br>
          123 Rue de l'Entreprise<br>
          Ville, Pays<br>
          contact@entreprise.com
        </div>
      </div>

      <div class="title">RAPPORT D'INTERVENTION</div>

      <div class="report-info">
        <div><strong>Date du rapport:</strong> {{ now }}</div>
        <div><strong>ID Intervention:</strong> #{{ intervention_id }}</div>
      </div>
    </div>

    <!-- Informations client et intervention -->
    <div class="info-row no-break">
      <div class="info-box">
        <h3>Informations Client</h3>
        <div class="info-item">
          <span class="info-label">Nom:</span>
          <span class="info-value">{{ client_name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Adresse:</span>
          <span class="info-value">{{ client_address }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Contact:</span>
          <span class="info-value">{{ client_contact }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Référence:</span>
          <span class="info-value">Ticket #{{ ticket_id }}</span>
        </div>
      </div>

      <div class="info-box">
        <h3>Détails de l'Intervention</h3>
        <div class="info-item">
          <span class="info-label">Date:</span>
          <span class="info-value">{{ intervention_date }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Technicien:</span>
          <span class="info-value">{{ tech_name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Statut:</span>
          <span class="info-value">
            {{ status_display }}
            <span class="status-badge status-{{ intervention.status }}">{{ status_display }}</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Récapitulatif temps et coûts -->
    <table class="details-table no-break">
      <thead>
        <tr>
          <th colspan="2">Informations Temps</th>
          <th colspan="2">Récapitulatif des Coûts</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td width="25%"><strong>Heure de début</strong></td>
          <td width="25%">{{ start_time|default:"Non spécifiée" }}</td>
          <td width="25%"><strong>Frais de transport</strong></td>
          <td width="25%" class="cost-highlight">{{ transport_cost }} FCFA</td>
        </tr>
        <tr>
          <td><strong>Heure de fin</strong></td>
          <td>{{ end_time|default:"Non spécifiée" }}</td>
          <td><strong>Frais supplémentaires</strong></td>
          <td class="cost-highlight">{{ additional_costs }} FCFA</td>
        </tr>
        <tr>
          <td><strong>Heures travaillées</strong></td>
          <td>{{ hours_worked }} heures</td>
          <td><strong>Coût total</strong></td>
          <td class="cost-highlight">{{ total_cost }} FCFA</td>
        </tr>
        <tr>
          <td><strong>Temps de déplacement</strong></td>
          <td>{{ travel_time }} heures</td>
          <td><strong>Temps total</strong></td>
          <td>{{ hours_worked|add:travel_time }} heures</td>
        </tr>
      </tbody>
    </table>

    <!-- Détails de l'intervention -->
    <div class="section no-break">
      <div class="section-title">Détails de l'Intervention</div>
      <div class="section-content">
        {{ report|linebreaks }}
      </div>
    </div>

    <!-- Matériel utilisé -->
    {% if materials %}
    <div class="section no-break">
      <div class="section-title">Matériel Utilisé</div>
      <table class="materials-table">
        <thead>
          <tr>
            <th width="60%">Matériel</th>
            <th width="20%">Quantité</th>
            <th width="20%">Coût</th>
          </tr>
        </thead>
        <tbody>
          {% for m in materials %}
          <tr>
            <td>{{ m.name }}</td>
            <td>{{ m.qty }}</td>
            <td>{{ m.cost }} FCFA</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

    <!-- Signatures -->
    <div class="signature-row no-break">
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-name">{{ tech_name }}</div>
        <div class="signature-date">Signature du technicien | Date: {{ now|date:"d/m/Y" }}</div>
      </div>
      
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-name">{{ client_name }}</div>
        <div class="signature-date">Signature du client | Date: _______________</div>
      </div>
    </div>

    <!-- Pied de page -->
    <div class="footer">
      Rapport généré le {{ now }} | Nom de Votre Entreprise | www.votresentreprise.com
    </div>
  </div>
</body>
</html>